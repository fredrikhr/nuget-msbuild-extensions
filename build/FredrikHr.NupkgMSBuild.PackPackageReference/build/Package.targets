<?xml version="1.0" encoding="UTF-8"?>
<Project>

  <Target Name="GetPackablePackageReferences">
    <ItemGroup>
      <PackablePackageReference Include="@(PackageReference->WithMetadataValue('Pack', 'true'))" />
    </ItemGroup>
  </Target>

  <Target
    Name="BuiltProjectOutputGroupDependenciesTfmSpecificBuildOutput"
    DependsOnTargets="GetPackablePackageReferences;BuiltProjectOutputGroupDependencies;SatelliteDllsProjectOutputGroupDependencies;DocumentationProjectOutputGroupDependencies;SGenFilesOutputGroupDependencies"
  >
    <ItemGroup>
      <TfmSpecificBuildOutputProjectOutputGroupDependency
        Include="@(BuiltProjectOutputGroupDependency->WithMetadataValue('ReferenceSourceTarget', 'ResolveAssemblyReference')->HasMetadata('NuGetPackageId'))"
        Exclude="@(BuiltProjectOutputGroupDependency->WithMetadataValue('Pack', 'false'))"
      >
        <PackablePackageReference>%(PackablePackageReference.Identity)</PackablePackageReference>
      </TfmSpecificBuildOutputProjectOutputGroupDependency>
      <TfmSpecificBuildOutputProjectOutputGroupDependency
        Include="@(SatelliteDllsProjectOutputGroupDependency->WithMetadataValue('ReferenceSourceTarget', 'ResolveAssemblyReference')->HasMetadata('NuGetPackageId'))"
        Exclude="@(SatelliteDllsProjectOutputGroupDependency->WithMetadataValue('Pack', 'false'))"
      >
        <PackablePackageReference>%(PackablePackageReference.Identity)</PackablePackageReference>
      </TfmSpecificBuildOutputProjectOutputGroupDependency>
      <TfmSpecificBuildOutputProjectOutputGroupDependency
        Include="@(DocumentationProjectOutputGroupDependency->WithMetadataValue('ReferenceSourceTarget', 'ResolveAssemblyReference')->HasMetadata('NuGetPackageId'))"
        Exclude="@(DocumentationProjectOutputGroupDependency->WithMetadataValue('Pack', 'false'))"
      >
        <PackablePackageReference>%(PackablePackageReference.Identity)</PackablePackageReference>
      </TfmSpecificBuildOutputProjectOutputGroupDependency>
      <TfmSpecificBuildOutputProjectOutputGroupDependency
        Include="@(SGenFilesOutputGroupDependency->WithMetadataValue('ReferenceSourceTarget', 'ResolveAssemblyReference')->HasMetadata('NuGetPackageId'))"
        Exclude="@(SGenFilesOutputGroupDependency->WithMetadataValue('Pack', 'false'))"
      >
        <PackablePackageReference>%(PackablePackageReference.Identity)</PackablePackageReference>
      </TfmSpecificBuildOutputProjectOutputGroupDependency>
      <TfmSpecificBuildOutputProjectOutputGroupDependency
        Remove="@(TfmSpecificBuildOutputProjectOutputGroupDependency)"
        Condition="'%(NuGetPackageId)' != '%(PackablePackageReference)'"
      />
      <BuildOutputInPackage Include="@(TfmSpecificBuildOutputProjectOutputGroupDependency)" />
    </ItemGroup>
  </Target>

  <Target
    Name="DebugSymbolsProjectOutputGroupDependenciesTfmSpecificDebugSymbolsInPackage"
    DependsOnTargets="GetPackablePackageReferences;DebugSymbolsProjectOutputGroupDependencies"
  >
    <ItemGroup>
      <DebugSymbolsInPackageProjectOutputGroupDependency
        Include="@(DebugSymbolsProjectOutputGroupDependency->WithMetadataValue('ReferenceSourceTarget', 'ResolveAssemblyReference')->HasMetadata('NuGetPackageId'))"
        Exclude="@(DebugSymbolsProjectOutputGroupDependency->WithMetadataValue('Pack', 'false'))"
      >
        <PackablePackageReference>%(PackablePackageReference.Identity)</PackablePackageReference>
      </DebugSymbolsInPackageProjectOutputGroupDependency>
      <TfmSpecificDebugSymbolsFile Include="@(DebugSymbolsInPackageProjectOutputGroupDependency)" />
    </ItemGroup>
  </Target>

</Project>
